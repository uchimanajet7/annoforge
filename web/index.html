<!-- リポジトリ再編: web/ 配下へ移動 -->
<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AnnoForge - 画像アノテーションツール</title>
  <!-- メタ: OGP/Twitter（名称整合） -->
  <meta name="description" content="AnnoForge は、WebUIで図形アノテーションを作成し、AWS Lambda APIで画像に描画・S3保存できるツールです。">
  <meta name="application-name" content="AnnoForge">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="AnnoForge">
  <meta property="og:title" content="AnnoForge - 画像アノテーションツール">
  <meta property="og:description" content="WebUIで図形アノテーションを作成し、Lambda APIで画像に描画・S3保存するツール。">
  <meta property="og:locale" content="ja_JP">
  <meta property="og:image" content="ogp.png">
  <meta property="og:image:alt" content="AnnoForge">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:image" content="ogp.png">
  <!-- 参考: SVG版も同梱（互換のためPNGを優先）。必要時に差し替え可。
       <meta property="og:image" content="ogp.svg"> -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="AnnoForge - 画像アノテーションツール">
  <meta name="twitter:description" content="WebUIで図形アノテーションを作成し、Lambda APIで画像に描画・S3保存するツール。">
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="dns-prefetch" href="https://unpkg.com">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <h1>AnnoForge - 画像アノテーションツール</h1>
    <div class="controls controls-top" role="group" aria-label="グローバル操作">
      <div class="file-controls" role="group" aria-label="画像の読み込み">
        <label for="imageInput" class="file-label">画像:</label>
        <button id="openFileBtn" type="button" class="file-pick-btn" aria-label="画像を選択">画像を選択</button>
        <input type="file" id="imageInput" accept="image/*" class="visually-hidden">
        <span id="imageNameTop" class="image-name" aria-live="polite" title=""></span>
      </div>
      <div class="global-actions" role="group" aria-label="出力と状態">
        <button id="downloadImageBtn">注釈付き画像を保存</button>
        <button id="clearBtn">全てクリア</button>
      </div>
    </div>
    <div class="canvas-container">
      <div id="stageContainer"></div>
      <div id="coordinates"></div>
      <div id="statusBar" class="status-bar" aria-live="polite"></div>
      <div class="floating-zoom" role="group" aria-label="表示操作">
        <button class="tool-btn active" data-tool="select" title="選択" aria-label="選択">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M3 2l7 18 2-7 7-2L3 2z" fill="#2c3e50"/></svg>
        </button>
        <button id="zoomInBtn" class="zoom-btn" title="拡大" aria-label="拡大">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
            <circle cx="10" cy="10" r="7" stroke="#2c3e50" stroke-width="2" fill="none"/>
            <line x1="10" y1="7" x2="10" y2="13" stroke="#2c3e50" stroke-width="2"/>
            <line x1="7" y1="10" x2="13" y2="10" stroke="#2c3e50" stroke-width="2"/>
          </svg>
        </button>
        <button id="zoomOutBtn" class="zoom-btn" title="縮小" aria-label="縮小">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
            <circle cx="10" cy="10" r="7" stroke="#2c3e50" stroke-width="2" fill="none"/>
            <line x1="7" y1="10" x2="13" y2="10" stroke="#2c3e50" stroke-width="2"/>
          </svg>
        </button>
        <button id="zoomResetBtn" class="zoom-btn" title="表示をリセット" aria-label="表示をリセット">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
            <path d="M12 3a9 9 0 109 9h-2a7 7 0 11-7-7V3z" fill="#2c3e50"/>
          </svg>
        </button>
        <div id="zoomBadge" class="zoom-badge" aria-label="現在の倍率">100%</div>
      </div>
    </div>
    <div class="controls controls-below">
      <div class="toolbar" role="toolbar" aria-label="アノテーションツール">
        <div class="tool-buttons">
          <button class="tool-btn" data-tool="rectangle" title="矩形" aria-label="矩形">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><rect x="4" y="6" width="16" height="12" stroke="#2c3e50" stroke-width="2" fill="none"/></svg>
          </button>
          <button class="tool-btn" data-tool="line" title="直線" aria-label="直線">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M4 18 L20 6" stroke="#2c3e50" stroke-width="2"/></svg>
          </button>
          <button class="tool-btn" data-tool="polygon" title="多角形" aria-label="多角形">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 8 L12 4 L18 8 L16 16 L8 16 Z" stroke="#2c3e50" stroke-width="2" fill="none"/></svg>
          </button>
          <button class="tool-btn" data-tool="circle" title="円" aria-label="円">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><circle cx="12" cy="12" r="7" stroke="#2c3e50" stroke-width="2" fill="none"/></svg>
          </button>
          <button class="tool-btn" data-tool="parallelogram" title="平行四辺形" aria-label="平行四辺形">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 8 H18 L14 16 H2 Z" stroke="#2c3e50" stroke-width="2" fill="none"/></svg>
          </button>
        </div>
        <div class="color-controls">
          <div class="swatches" id="colorSwatches" aria-label="色の選択">
            <!-- JSで既定色を挿入 -->
          </div>
          <input type="color" id="colorPicker" aria-label="任意の色" />
        </div>
        
      </div>
    </div>
    
    <div class="annotations">
      <div class="annotations-header section-header">
        <div class="section-spacer" aria-hidden="true"></div>
        <h2 class="section-title">アノテーション一覧</h2>
        <div class="section-actions" aria-label="アノテーション操作"></div>
      </div>
      <div id="annotationList"></div>

      <div class="json-display-container">
        <div class="section-header">
          <div class="section-spacer" aria-hidden="true"></div>
          <h2 class="section-title">JSON形式</h2>
          <div class="section-actions" aria-label="JSON操作">
            <button id="copyJsonBtn" class="icon-btn" title="JSONをコピー" aria-label="JSONをコピー">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M16 1H4C2.89543 1 2 1.89543 2 3V15" stroke="#2c3e50" stroke-width="2"/>
                <rect x="6" y="5" width="16" height="18" rx="2" stroke="#2c3e50" stroke-width="2"/>
              </svg>
            </button>
            <button id="downloadJsonBtn" class="icon-btn" title="JSONをダウンロード" aria-label="JSONをダウンロード">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M12 3v12" stroke="#2c3e50" stroke-width="2"/>
                <path d="M8 11l4 4 4-4" stroke="#2c3e50" stroke-width="2"/>
                <rect x="4" y="19" width="16" height="2" fill="#2c3e50"/>
              </svg>
            </button>
            <button id="openImportModalBtn" class="icon-btn" title="JSONをインポート" aria-label="JSONをインポート">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M12 21V9" stroke="#2c3e50" stroke-width="2"/>
                <path d="M8 13l4-4 4 4" stroke="#2c3e50" stroke-width="2"/>
                <rect x="4" y="3" width="16" height="2" fill="#2c3e50"/>
              </svg>
            </button>
          </div>
        </div>
        <pre id="jsonDisplay" class="json-display"></pre>
      </div>
    </div>
    <footer class="footer" role="contentinfo">
      <small>© AnnoForge</small>
    </footer>
  </div>
  
  <!-- インポートモーダル -->
  <div id="importModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="importModalTitle" aria-hidden="true">
    <div class="modal__overlay" data-close-modal></div>
    <div class="modal__content" role="document">
      <div class="modal__header">
        <h3 id="importModalTitle">JSONインポート</h3>
        <button class="modal__close" id="closeImportModalBtn" aria-label="閉じる" title="閉じる">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 6 L18 18 M18 6 L6 18" stroke="#2c3e50" stroke-width="2"/>
          </svg>
        </button>
      </div>
      <div class="modal__body">
        <p style="margin-bottom:8px;color:#555;">既存アノテーションを置き換えます。貼り付け・ファイル選択・ドロップのいずれかでJSONを入力してください。</p>
        <div class="import-grid">
          <div>
            <div class="import-toolbar">
              <button id="importPasteBtn" class="icon-btn" title="クリップボードから貼り付け" aria-label="クリップボードから貼り付け">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <rect x="6" y="3" width="12" height="16" rx="2" stroke="#2c3e50" stroke-width="2"/>
                  <path d="M9 1h6v3H9z" fill="#2c3e50"/>
                  <path d="M12 9v8M9 12h6" stroke="#2c3e50" stroke-width="2"/>
                </svg>
              </button>
            </div>
            <textarea id="importJsonText" placeholder="ここにJSONを貼り付け" rows="8"></textarea>
          </div>
          <div class="import-side">
            <label class="file-label" for="importJsonFile">ファイル選択:</label>
            <input type="file" id="importJsonFile" accept="application/json">
            <div id="importDropZone" class="dropzone" aria-label="ここにJSONファイルをドロップ">
              .json をドロップ
            </div>
            <div id="importSummary" class="import-summary"></div>
          </div>
        </div>
      </div>
      <div class="modal__footer">
        <button id="runImportBtn" disabled>インポート</button>
        <button id="cancelImportBtn" class="secondary">キャンセル</button>
      </div>
    </div>
  </div>
  <!-- Konva.js（固定バージョン） -->
  <script src="https://unpkg.com/konva@10.0.12/konva.min.js"></script>
  <script src="app.js"></script>
</body>

</html>
